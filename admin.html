<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MIGA Admin Command Center</title>
    <style>
        :root { --primary: #1a73e8; --dark: #121212; --danger: #d93025; --success: #188038; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; display: flex; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--dark); color: white; height: 100vh; position: fixed; padding: 20px; }
        .sidebar h2 { color: #f4b400; font-size: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .nav-link { display: block; color: #ccc; text-decoration: none; padding: 12px 0; border-bottom: 1px solid #222; }
        .nav-link:hover { color: white; }

        /* Main Content */
        .main { margin-left: 300px; padding: 40px; width: 100%; }
        .section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: #666; }

        .btn { border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-right: 5px; }
        .btn-approve { background: var(--success); color: white; }
        .btn-delete { background: var(--danger); color: white; }
        .btn-create { background: var(--primary); color: white; width: 100%; padding: 12px; margin-top: 10px; }
        
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .badge-pending { background: #fff4e5; color: #b76e00; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>MIGA ADMIN</h2>
    <a href="index.html" class="nav-link">‚Üê Public Website</a>
    <a href="#ideas-section" class="nav-link">Transformation Ideas</a>
    <a href="#apps-section" class="nav-link">Membership Requests</a>
    <a href="#teams-section" class="nav-link">Manage Work Groups</a>
</div>

<div class="main">
    <h1>Dashboard Overview</h1>

    <div class="section" id="teams-section">
        <h2>Create New Work Group</h2>
        <input type="text" id="teamNameInput" placeholder="Enter Team Name (e.g., Clean Ganga Project)" style="width:70%; padding:10px;">
        <button class="btn btn-create" onclick="createNewTeam()" style="width:25%;">Create Team</button>
    </div>

    <div class="section" id="apps-section">
        <h2>Membership Requests</h2>
        <table id="appsTable">
            <thead>
                <tr><th>Name</th><th>Email</th><th>Role</th><th>Action</th></tr>
            </thead>
            <tbody id="appsBody"></tbody>
        </table>
    </div>

    <div class="section" id="ideas-section">
        <h2>Submitted Ideas</h2>
        <table id="ideasTable">
            <thead>
                <tr><th>Name</th><th>Category</th><th>Idea</th><th>Action</th></tr>
            </thead>
            <tbody id="ideasBody"></tbody>
        </table>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // PASTE YOUR FIREBASE CONFIG HERE
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "project--miga.firebaseapp.com",
        projectId: "project--miga",
        storageBucket: "project--miga.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- A. PROTECT THE PAGE WITH A SIMPLE PASSWORD ---
    const pass = prompt("Enter Admin Password:");
    if(pass !== "Opac@0000") {
        alert("Wrong Password");
        window.location.href = "index.html";
    }

    // --- B. LOAD MEMBERSHIP APPLICATIONS ---
    onSnapshot(collection(db, "team_applications"), (snapshot) => {
        const tbody = document.getElementById('appsBody');
        tbody.innerHTML = "";
        snapshot.forEach(item => {
            const d = item.data();
            if(d.status === "approved") return;
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${d.name}</td><td>${d.email}</td><td><span class="badge badge-pending">${d.role}</span></td>
                <td>
                    <button class="btn btn-approve" onclick="approveMember('${item.id}', '${d.name}', '${d.email}')">Approve</button>
                    <button class="btn btn-delete" onclick="rejectMember('${item.id}')">Reject</button>
                </td>`;
            tbody.appendChild(tr);
        });
    });

    // --- C. LOAD PUBLIC IDEAS ---
    onSnapshot(collection(db, "ideas"), (snapshot) => {
        const tbody = document.getElementById('ideasBody');
        tbody.innerHTML = "";
        snapshot.forEach(item => {
            const d = item.data();
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${d.name}</td><td><strong>${d.category}</strong></td><td>${d.text}</td>
                <td><button class="btn btn-delete" onclick="deleteIdea('${item.id}')">Remove</button></td>`;
            tbody.appendChild(tr);
        });
    });

    // --- D. LOGIC FUNCTIONS ---
    window.approveMember = async (id, name, email) => {
        await updateDoc(doc(db, "team_applications", id), { status: "approved" });
        await addDoc(collection(db, "approved_members"), { name, email, date: new Date() });
        alert("Member Approved! They can now access the Team Hub.");
    };

    window.rejectMember = async (id) => {
        if(confirm("Are you sure you want to reject this applicant?")) {
            await deleteDoc(doc(db, "team_applications", id));
        }
    };

    window.deleteIdea = async (id) => {
        if(confirm("Delete this idea?")) await deleteDoc(doc(db, "ideas", id));
    };

    window.createNewTeam = async () => {
        const name = document.getElementById('teamNameInput').value;
        if(!name) return;
        await addDoc(collection(db, "teams"), { name: name, createdAt: new Date() });
        document.getElementById('teamNameInput').value = "";
        alert("New Team Room Created!");
    };
</script>

</body>
</html>

